{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 10, "column": 0}, "map": {"version":3,"sources":["file:///Users/wushuai/Documents/research/med-triage/Med-Triage/components/SankeyChart.tsx"],"sourcesContent":["import React from 'react';\nimport { Sankey, Tooltip, ResponsiveContainer, Layer, Rectangle } from 'recharts';\nimport { AnalysisResult, SankeyData } from '../types';\n\ninterface SankeyChartProps {\n  data: AnalysisResult | null;\n}\n\nconst SankeyChart: React.FC<SankeyChartProps> = ({ data }) => {\n  if (!data || data.diagnoses.length === 0) {\n    return (\n      <div className=\"flex items-center justify-center h-full text-slate-400 text-sm\">\n        <p>开始对话以生成症状图谱...</p>\n      </div>\n    );\n  }\n\n  // Transform AnalysisResult into SankeyData format for Recharts\n  // Recharts Sankey requires strict indices for source/target\n  const transformData = (): SankeyData => {\n    const nodes: { name: string }[] = [];\n    const nodeIndexMap = new Map<string, number>();\n\n    const getOrAddNode = (name: string) => {\n      if (!nodeIndexMap.has(name)) {\n        nodes.push({ name });\n        nodeIndexMap.set(name, nodes.length - 1);\n      }\n      return nodeIndexMap.get(name)!;\n    };\n\n    const links = data.symptomConnections.map(conn => ({\n      source: getOrAddNode(conn.symptom),\n      target: getOrAddNode(conn.condition),\n      value: conn.strength\n    }));\n\n    return { nodes, links };\n  };\n\n  const chartData = transformData();\n\n  // Custom Node Content\n  const renderNode = (props: any) => {\n    const { x, y, width, height, index, payload, containerWidth } = props;\n    const isOut = x + width + 6 > containerWidth / 2;\n    \n    // Distinct colors for Symptoms (Left) vs Conditions (Right)\n    const isSymptom = !data.diagnoses.some(d => d.name === payload.name);\n    const fill = isSymptom ? '#60a5fa' : '#f87171'; // Blue for symptoms, Red for diseases\n\n    return (\n      <Layer key={`CustomNode${index}`}>\n        <Rectangle\n          x={x}\n          y={y}\n          width={width}\n          height={height}\n          fill={fill}\n          fillOpacity=\"0.9\"\n        />\n        <text\n          textAnchor={isOut ? 'end' : 'start'}\n          x={isOut ? x - 6 : x + width + 6}\n          y={y + height / 2}\n          fontSize=\"12\"\n          fontWeight=\"500\"\n          fill=\"#334155\"\n          dy=\"0.35em\"\n        >\n          {payload.name}\n        </text>\n      </Layer>\n    );\n  };\n\n  return (\n    <div className=\"w-full h-full min-h-[300px]\">\n        <ResponsiveContainer width=\"100%\" height=\"100%\">\n            <Sankey\n            data={chartData}\n            node={renderNode}\n            nodePadding={50}\n            link={{ stroke: '#cbd5e1', fill: 'none' }}\n            margin={{ top: 20, right: 20, bottom: 20, left: 20 }}\n            >\n            <Tooltip content={({ payload }) => {\n                if (payload && payload.length > 0) {\n                    const data = payload[0];\n                    return (\n                        <div className=\"bg-white p-2 border border-slate-200 shadow-md rounded text-xs\">\n                            <p className=\"font-semibold\">{data.name}</p>\n                            <p>关联强度: {data.value}</p>\n                        </div>\n                    )\n                }\n                return null;\n            }} />\n            </Sankey>\n        </ResponsiveContainer>\n    </div>\n  );\n};\n\nexport default SankeyChart;"],"names":[],"mappings":";;;;;AACA;AAAA;AAAA;AAAA;AAAA;;;AAOA,MAAM,cAA0C,CAAC,EAAE,IAAI,EAAE;IACvD,IAAI,CAAC,QAAQ,KAAK,SAAS,CAAC,MAAM,KAAK,GAAG;QACxC,qBACE,8OAAC;YAAI,WAAU;sBACb,cAAA,8OAAC;0BAAE;;;;;;;;;;;IAGT;IAEA,+DAA+D;IAC/D,4DAA4D;IAC5D,MAAM,gBAAgB;QACpB,MAAM,QAA4B,EAAE;QACpC,MAAM,eAAe,IAAI;QAEzB,MAAM,eAAe,CAAC;YACpB,IAAI,CAAC,aAAa,GAAG,CAAC,OAAO;gBAC3B,MAAM,IAAI,CAAC;oBAAE;gBAAK;gBAClB,aAAa,GAAG,CAAC,MAAM,MAAM,MAAM,GAAG;YACxC;YACA,OAAO,aAAa,GAAG,CAAC;QAC1B;QAEA,MAAM,QAAQ,KAAK,kBAAkB,CAAC,GAAG,CAAC,CAAA,OAAQ,CAAC;gBACjD,QAAQ,aAAa,KAAK,OAAO;gBACjC,QAAQ,aAAa,KAAK,SAAS;gBACnC,OAAO,KAAK,QAAQ;YACtB,CAAC;QAED,OAAO;YAAE;YAAO;QAAM;IACxB;IAEA,MAAM,YAAY;IAElB,sBAAsB;IACtB,MAAM,aAAa,CAAC;QAClB,MAAM,EAAE,CAAC,EAAE,CAAC,EAAE,KAAK,EAAE,MAAM,EAAE,KAAK,EAAE,OAAO,EAAE,cAAc,EAAE,GAAG;QAChE,MAAM,QAAQ,IAAI,QAAQ,IAAI,iBAAiB;QAE/C,4DAA4D;QAC5D,MAAM,YAAY,CAAC,KAAK,SAAS,CAAC,IAAI,CAAC,CAAA,IAAK,EAAE,IAAI,KAAK,QAAQ,IAAI;QACnE,MAAM,OAAO,YAAY,YAAY,WAAW,sCAAsC;QAEtF,qBACE,8OAAC,8JAAK;;8BACJ,8OAAC,kKAAS;oBACR,GAAG;oBACH,GAAG;oBACH,OAAO;oBACP,QAAQ;oBACR,MAAM;oBACN,aAAY;;;;;;8BAEd,8OAAC;oBACC,YAAY,QAAQ,QAAQ;oBAC5B,GAAG,QAAQ,IAAI,IAAI,IAAI,QAAQ;oBAC/B,GAAG,IAAI,SAAS;oBAChB,UAAS;oBACT,YAAW;oBACX,MAAK;oBACL,IAAG;8BAEF,QAAQ,IAAI;;;;;;;WAlBL,CAAC,UAAU,EAAE,OAAO;;;;;IAsBpC;IAEA,qBACE,8OAAC;QAAI,WAAU;kBACX,cAAA,8OAAC,0LAAmB;YAAC,OAAM;YAAO,QAAO;sBACrC,cAAA,8OAAC,4JAAM;gBACP,MAAM;gBACN,MAAM;gBACN,aAAa;gBACb,MAAM;oBAAE,QAAQ;oBAAW,MAAM;gBAAO;gBACxC,QAAQ;oBAAE,KAAK;oBAAI,OAAO;oBAAI,QAAQ;oBAAI,MAAM;gBAAG;0BAEnD,cAAA,8OAAC,kKAAO;oBAAC,SAAS,CAAC,EAAE,OAAO,EAAE;wBAC1B,IAAI,WAAW,QAAQ,MAAM,GAAG,GAAG;4BAC/B,MAAM,OAAO,OAAO,CAAC,EAAE;4BACvB,qBACI,8OAAC;gCAAI,WAAU;;kDACX,8OAAC;wCAAE,WAAU;kDAAiB,KAAK,IAAI;;;;;;kDACvC,8OAAC;;4CAAE;4CAAO,KAAK,KAAK;;;;;;;;;;;;;wBAGhC;wBACA,OAAO;oBACX;;;;;;;;;;;;;;;;;;;;;AAKZ;uCAEe"}},
    {"offset": {"line": 185, "column": 0}, "map": {"version":3,"sources":["file:///Users/wushuai/Documents/research/med-triage/Med-Triage/types.ts"],"sourcesContent":["export interface Message {\n  id: string;\n  role: 'user' | 'model';\n  text: string;\n  timestamp: Date;\n  options?: string[];\n  allowMultiple?: boolean;\n}\n\nexport enum UrgencyLevel {\n  Low = 'Low',\n  Medium = 'Medium',\n  High = 'High',\n  Critical = 'Critical'\n}\n\nexport interface Diagnosis {\n  name: string;\n  probability: number; // 0-100\n  description: string;\n  urgency: UrgencyLevel;\n  recommendedAction: string;\n}\n\nexport interface SymptomConnection {\n  symptom: string;\n  condition: string;\n  strength: number; // weight of the link\n}\n\nexport interface AnalysisResult {\n  diagnoses: Diagnosis[];\n  symptomConnections: SymptomConnection[];\n}\n\nexport interface SankeyNode {\n  name: string;\n}\n\nexport interface SankeyLink {\n  source: number;\n  target: number;\n  value: number;\n}\n\nexport interface SankeyData {\n  nodes: SankeyNode[];\n  links: SankeyLink[];\n}"],"names":[],"mappings":";;;;AASO,IAAA,AAAK,sCAAA;;;;;WAAA"}},
    {"offset": {"line": 200, "column": 0}, "map": {"version":3,"sources":["file:///Users/wushuai/Documents/research/med-triage/Med-Triage/components/DiagnosisPanel.tsx"],"sourcesContent":["import React from 'react';\nimport { AnalysisResult, UrgencyLevel } from '../types';\n\ninterface DiagnosisPanelProps {\n  data: AnalysisResult | null;\n  isLoading: boolean;\n}\n\nconst DiagnosisPanel: React.FC<DiagnosisPanelProps> = ({ data, isLoading }) => {\n  if (isLoading) {\n    return (\n      <div className=\"h-full flex flex-col items-center justify-center space-y-3\">\n        <div className=\"w-8 h-8 border-4 border-blue-500 border-t-transparent rounded-full animate-spin\"></div>\n        <p className=\"text-slate-500 text-sm animate-pulse\">正在分析临床数据...</p>\n      </div>\n    );\n  }\n\n  if (!data || data.diagnoses.length === 0) {\n    return (\n      <div className=\"h-full flex items-center justify-center text-slate-400 text-sm px-6 text-center\">\n        <p>暂无诊断结果。请在左侧描述症状并点击“更新分析”。</p>\n      </div>\n    );\n  }\n\n  const getUrgencyColor = (urgency: UrgencyLevel) => {\n    switch (urgency) {\n      case UrgencyLevel.Critical: return 'bg-red-100 text-red-800 border-red-200';\n      case UrgencyLevel.High: return 'bg-orange-100 text-orange-800 border-orange-200';\n      case UrgencyLevel.Medium: return 'bg-yellow-100 text-yellow-800 border-yellow-200';\n      case UrgencyLevel.Low: return 'bg-green-100 text-green-800 border-green-200';\n      default: return 'bg-slate-100 text-slate-800';\n    }\n  };\n\n  const getUrgencyLabel = (urgency: UrgencyLevel) => {\n    switch (urgency) {\n      case UrgencyLevel.Critical: return '危重';\n      case UrgencyLevel.High: return '紧急';\n      case UrgencyLevel.Medium: return '关注';\n      case UrgencyLevel.Low: return '普通';\n      default: return urgency;\n    }\n  };\n\n  return (\n    <div className=\"space-y-4 overflow-y-auto h-full pr-2\">\n      {data.diagnoses.map((dx, index) => (\n        <div key={index} className=\"bg-white p-4 rounded-lg border border-slate-200 shadow-sm transition-all hover:shadow-md\">\n          <div className=\"flex justify-between items-start mb-2\">\n            <h3 className=\"font-bold text-slate-800 text-lg\">{dx.name}</h3>\n            <span className={`px-2 py-1 rounded text-xs font-semibold border ${getUrgencyColor(dx.urgency)}`}>\n              {getUrgencyLabel(dx.urgency)}\n            </span>\n          </div>\n          \n          <div className=\"mb-3\">\n            <div className=\"flex items-center justify-between text-xs text-slate-500 mb-1\">\n              <span>可能性</span>\n              <span>{dx.probability}%</span>\n            </div>\n            <div className=\"w-full bg-slate-100 rounded-full h-2\">\n              <div \n                className=\"bg-blue-600 h-2 rounded-full transition-all duration-500\" \n                style={{ width: `${dx.probability}%` }}\n              ></div>\n            </div>\n          </div>\n\n          <p className=\"text-sm text-slate-600 mb-3 leading-relaxed\">\n            {dx.description}\n          </p>\n\n          <div className=\"bg-slate-50 p-2 rounded text-xs text-slate-700 border border-slate-100\">\n            <strong className=\"font-semibold text-slate-900\">建议处置:</strong> {dx.recommendedAction}\n          </div>\n        </div>\n      ))}\n    </div>\n  );\n};\n\nexport default DiagnosisPanel;"],"names":[],"mappings":";;;;;AACA;;;AAOA,MAAM,iBAAgD,CAAC,EAAE,IAAI,EAAE,SAAS,EAAE;IACxE,IAAI,WAAW;QACb,qBACE,8OAAC;YAAI,WAAU;;8BACb,8OAAC;oBAAI,WAAU;;;;;;8BACf,8OAAC;oBAAE,WAAU;8BAAuC;;;;;;;;;;;;IAG1D;IAEA,IAAI,CAAC,QAAQ,KAAK,SAAS,CAAC,MAAM,KAAK,GAAG;QACxC,qBACE,8OAAC;YAAI,WAAU;sBACb,cAAA,8OAAC;0BAAE;;;;;;;;;;;IAGT;IAEA,MAAM,kBAAkB,CAAC;QACvB,OAAQ;YACN,KAAK,qHAAY,CAAC,QAAQ;gBAAE,OAAO;YACnC,KAAK,qHAAY,CAAC,IAAI;gBAAE,OAAO;YAC/B,KAAK,qHAAY,CAAC,MAAM;gBAAE,OAAO;YACjC,KAAK,qHAAY,CAAC,GAAG;gBAAE,OAAO;YAC9B;gBAAS,OAAO;QAClB;IACF;IAEA,MAAM,kBAAkB,CAAC;QACvB,OAAQ;YACN,KAAK,qHAAY,CAAC,QAAQ;gBAAE,OAAO;YACnC,KAAK,qHAAY,CAAC,IAAI;gBAAE,OAAO;YAC/B,KAAK,qHAAY,CAAC,MAAM;gBAAE,OAAO;YACjC,KAAK,qHAAY,CAAC,GAAG;gBAAE,OAAO;YAC9B;gBAAS,OAAO;QAClB;IACF;IAEA,qBACE,8OAAC;QAAI,WAAU;kBACZ,KAAK,SAAS,CAAC,GAAG,CAAC,CAAC,IAAI,sBACvB,8OAAC;gBAAgB,WAAU;;kCACzB,8OAAC;wBAAI,WAAU;;0CACb,8OAAC;gCAAG,WAAU;0CAAoC,GAAG,IAAI;;;;;;0CACzD,8OAAC;gCAAK,WAAW,CAAC,+CAA+C,EAAE,gBAAgB,GAAG,OAAO,GAAG;0CAC7F,gBAAgB,GAAG,OAAO;;;;;;;;;;;;kCAI/B,8OAAC;wBAAI,WAAU;;0CACb,8OAAC;gCAAI,WAAU;;kDACb,8OAAC;kDAAK;;;;;;kDACN,8OAAC;;4CAAM,GAAG,WAAW;4CAAC;;;;;;;;;;;;;0CAExB,8OAAC;gCAAI,WAAU;0CACb,cAAA,8OAAC;oCACC,WAAU;oCACV,OAAO;wCAAE,OAAO,GAAG,GAAG,WAAW,CAAC,CAAC,CAAC;oCAAC;;;;;;;;;;;;;;;;;kCAK3C,8OAAC;wBAAE,WAAU;kCACV,GAAG,WAAW;;;;;;kCAGjB,8OAAC;wBAAI,WAAU;;0CACb,8OAAC;gCAAO,WAAU;0CAA+B;;;;;;4BAAc;4BAAE,GAAG,iBAAiB;;;;;;;;eA1B/E;;;;;;;;;;AAgClB;uCAEe"}},
    {"offset": {"line": 405, "column": 0}, "map": {"version":3,"sources":["file:///Users/wushuai/Documents/research/med-triage/Med-Triage/app/page.tsx"],"sourcesContent":["'use client'\n\nimport React, { useState, useRef, useEffect } from 'react';\nimport { Message, AnalysisResult } from '@/types';\nimport SankeyChart from '@/components/SankeyChart';\nimport DiagnosisPanel from '@/components/DiagnosisPanel';\nimport { \n  ChartBarIcon, \n  ArrowPathIcon, \n  PaperAirplaneIcon,\n  ShieldCheckIcon,\n  ExclamationTriangleIcon,\n  CheckCircleIcon\n} from '@heroicons/react/24/outline';\n\nconst App: React.FC = () => {\n  // State\n  const [mounted, setMounted] = useState(false);\n  const [messages, setMessages] = useState<Message[]>([]);\n  const [input, setInput] = useState('');\n  const [isTyping, setIsTyping] = useState(false);\n  const [isAnalyzing, setIsAnalyzing] = useState(false);\n  const [analysisResult, setAnalysisResult] = useState<AnalysisResult | null>(null);\n  const [selectedOptions, setSelectedOptions] = useState<Set<string>>(new Set());\n  \n  const messagesEndRef = useRef<HTMLDivElement>(null);\n\n  // Initialize messages after mount to avoid hydration mismatch\n  useEffect(() => {\n    setMounted(true);\n    setMessages([\n      {\n        id: '1',\n        role: 'model',\n        text: \"您好，我是您的智能分诊助手。请简要描述您最主要的不舒服症状（例如：头痛、腹痛、发烧等）。\",\n        timestamp: new Date(),\n        options: [],\n        allowMultiple: false\n      }\n    ]);\n  }, []);\n\n  // Auto-scroll to bottom of chat\n  useEffect(() => {\n    messagesEndRef.current?.scrollIntoView({ behavior: 'smooth' });\n  }, [messages, isTyping]);\n\n  const handleReset = () => {\n    if (messages.length > 1 && !window.confirm(\"确定要清除当前对话并重新开始吗？\")) {\n      return;\n    }\n    \n    setMessages([\n      {\n        id: '1',\n        role: 'model',\n        text: \"您好，我是您的智能分诊助手。请简要描述您最主要的不舒服症状（例如：头痛、腹痛、发烧等）。\",\n        timestamp: new Date(),\n        options: [],\n        allowMultiple: false\n      }\n    ]);\n    setInput('');\n    setIsTyping(false);\n    setIsAnalyzing(false);\n    setAnalysisResult(null);\n    setSelectedOptions(new Set());\n  };\n\n  const handleSendMessage = async (textOverride?: string) => {\n    const textToSend = textOverride || input.trim();\n    if (!textToSend || isTyping) return;\n\n    const userMsg: Message = {\n      id: Date.now().toString(),\n      role: 'user',\n      text: textToSend,\n      timestamp: new Date()\n    };\n\n    setMessages(prev => [...prev, userMsg]);\n    setInput('');\n    setSelectedOptions(new Set());\n    setIsTyping(true);\n\n    try {\n      // 调用后端 API\n      const response = await fetch('/api/chat', {\n        method: 'POST',\n        headers: {\n          'Content-Type': 'application/json',\n        },\n        body: JSON.stringify({\n          history: messages,\n          message: userMsg.text\n        })\n      });\n\n      if (!response.ok) {\n        throw new Error('Failed to get response');\n      }\n\n      const data = await response.json();\n\n      const botMsg: Message = {\n        id: (Date.now() + 1).toString(),\n        role: 'model',\n        text: data.text,\n        options: data.options,\n        allowMultiple: data.allowMultiple,\n        timestamp: new Date()\n      };\n\n      setMessages(prev => {\n        if (prev.length === 1 && prev[0].id === '1' && prev[0].text.includes(\"您好\")) {\n          return [...prev, botMsg]; \n        }\n        return [...prev, botMsg];\n      });\n    } catch (error) {\n      console.error('Error sending message:', error);\n      const errorMsg: Message = {\n        id: (Date.now() + 1).toString(),\n        role: 'model',\n        text: \"抱歉，系统遇到错误，请稍后重试。\",\n        timestamp: new Date()\n      };\n      setMessages(prev => [...prev, errorMsg]);\n    } finally {\n      setIsTyping(false);\n    }\n  };\n\n  const handleAnalyze = async () => {\n    if (messages.length < 2) return;\n    setIsAnalyzing(true);\n    \n    try {\n      const response = await fetch('/api/analyze', {\n        method: 'POST',\n        headers: {\n          'Content-Type': 'application/json',\n        },\n        body: JSON.stringify({\n          history: messages\n        })\n      });\n\n      if (!response.ok) {\n        throw new Error('Failed to analyze');\n      }\n\n      const result = await response.json();\n      setAnalysisResult(result);\n    } catch (error) {\n      console.error('Error analyzing:', error);\n    } finally {\n      setIsAnalyzing(false);\n    }\n  };\n\n  const handleKeyDown = (e: React.KeyboardEvent) => {\n    if (e.key === 'Enter' && !e.shiftKey) {\n      e.preventDefault();\n      handleSendMessage();\n    }\n  };\n\n  const toggleOption = (option: string, allowMultiple: boolean) => {\n    if (allowMultiple) {\n      const newSet = new Set(selectedOptions);\n      if (newSet.has(option)) {\n        newSet.delete(option);\n      } else {\n        newSet.add(option);\n      }\n      setSelectedOptions(newSet);\n    } else {\n      handleSendMessage(option);\n    }\n  };\n\n  const submitMultiSelection = () => {\n    if (selectedOptions.size === 0) return;\n    const combinedText = Array.from(selectedOptions).join(', ');\n    handleSendMessage(combinedText);\n  };\n\n  // Prevent hydration mismatch by not rendering until mounted\n  if (!mounted) {\n    return (\n      <div className=\"flex h-screen bg-slate-100 font-sans items-center justify-center\">\n        <div className=\"text-center\">\n          <div className=\"w-8 h-8 border-4 border-blue-500 border-t-transparent rounded-full animate-spin mx-auto\"></div>\n          <p className=\"text-slate-500 text-sm mt-3\">加载中...</p>\n        </div>\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"flex h-screen bg-slate-100 font-sans\">\n      \n      {/* Sidebar / Left Panel - Chat */}\n      <div className=\"w-full md:w-1/3 flex flex-col border-r border-slate-200 bg-white shadow-lg z-10\">\n        <header className=\"p-4 border-b border-blue-500 flex items-center justify-between bg-blue-600 text-white shadow-sm\">\n          <div className=\"flex items-center space-x-2\">\n            <ShieldCheckIcon className=\"w-6 h-6\" />\n            <h1 className=\"font-bold text-lg tracking-wide\">AI 智能分诊</h1>\n          </div>\n          <button\n            onClick={handleReset}\n            className=\"flex items-center space-x-1 px-3 py-1.5 bg-blue-700/50 hover:bg-blue-500 rounded-lg text-xs font-medium transition-colors border border-blue-400/30\"\n            title=\"清除当前会话\"\n          >\n            <ArrowPathIcon className=\"w-3.5 h-3.5\" />\n            <span>重新对话</span>\n          </button>\n        </header>\n\n        {/* Chat Messages */}\n        <div className=\"flex-1 overflow-y-auto p-4 space-y-4 scrollbar-hide bg-slate-50\">\n          {messages.map((msg, index) => {\n            const isLastMessage = index === messages.length - 1;\n            return (\n              <div key={msg.id} className=\"flex flex-col\">\n                <div className={`flex ${msg.role === 'user' ? 'justify-end' : 'justify-start'}`}>\n                  <div\n                    className={`max-w-[90%] rounded-2xl p-3 text-sm shadow-sm leading-relaxed ${\n                      msg.role === 'user'\n                        ? 'bg-blue-600 text-white rounded-br-none'\n                        : 'bg-white text-slate-800 border border-slate-200 rounded-bl-none'\n                    }`}\n                  >\n                    {msg.text}\n                  </div>\n                </div>\n\n                {isLastMessage && msg.role === 'model' && msg.options && msg.options.length > 0 && (\n                  <div className=\"mt-3 ml-2 max-w-[90%]\">\n                     <p className=\"text-xs text-slate-400 mb-2 pl-1 font-medium uppercase tracking-wider\">\n                       {msg.allowMultiple ? '请选择所有符合的项：' : '请选择一项：'}\n                     </p>\n                     <div className=\"flex flex-wrap gap-2\">\n                       {msg.options.map((option, i) => {\n                         const isSelected = selectedOptions.has(option);\n                         return (\n                           <button\n                             key={i}\n                             onClick={() => toggleOption(option, !!msg.allowMultiple)}\n                             className={`px-3 py-2 text-sm rounded-lg border transition-all duration-200 text-left ${\n                               isSelected\n                                 ? 'bg-blue-100 border-blue-400 text-blue-800 shadow-inner'\n                                 : 'bg-white border-slate-200 text-slate-700 hover:border-blue-300 hover:shadow-sm'\n                             }`}\n                           >\n                             <div className=\"flex items-center space-x-2\">\n                               {msg.allowMultiple && (\n                                  <div className={`w-4 h-4 rounded border flex items-center justify-center ${isSelected ? 'bg-blue-500 border-blue-500' : 'border-slate-300'}`}>\n                                     {isSelected && <CheckCircleIcon className=\"w-3 h-3 text-white\" />}\n                                  </div>\n                               )}\n                               <span>{option}</span>\n                             </div>\n                           </button>\n                         );\n                       })}\n                     </div>\n                     \n                     {msg.allowMultiple && selectedOptions.size > 0 && (\n                       <div className=\"mt-3\">\n                         <button\n                           onClick={submitMultiSelection}\n                           className=\"bg-blue-600 text-white text-sm px-4 py-2 rounded-lg hover:bg-blue-700 transition-colors shadow-sm flex items-center space-x-1\"\n                         >\n                           <span>确认选择</span>\n                           <PaperAirplaneIcon className=\"w-3 h-3\" />\n                         </button>\n                       </div>\n                     )}\n                  </div>\n                )}\n              </div>\n            );\n          })}\n          \n          {isTyping && (\n            <div className=\"flex justify-start\">\n              <div className=\"bg-white border border-slate-200 rounded-2xl rounded-bl-none p-3 shadow-sm\">\n                <div className=\"flex space-x-1\">\n                  <div className=\"w-2 h-2 bg-slate-400 rounded-full animate-bounce\"></div>\n                  <div className=\"w-2 h-2 bg-slate-400 rounded-full animate-bounce delay-75\"></div>\n                  <div className=\"w-2 h-2 bg-slate-400 rounded-full animate-bounce delay-150\"></div>\n                </div>\n              </div>\n            </div>\n          )}\n          <div ref={messagesEndRef} />\n        </div>\n\n        {/* Input Area */}\n        <div className=\"p-4 bg-white border-t border-slate-100\">\n          <div className=\"relative\">\n            <textarea\n              value={input}\n              onChange={(e) => setInput(e.target.value)}\n              onKeyDown={handleKeyDown}\n              placeholder=\"输入您的回答或从上方选择...\"\n              className=\"w-full pl-4 pr-12 py-3 bg-slate-100 border-none rounded-xl focus:ring-2 focus:ring-blue-500 resize-none text-sm text-slate-800 placeholder-slate-400\"\n              rows={2}\n            />\n            <button\n              onClick={() => handleSendMessage()}\n              disabled={!input.trim() || isTyping}\n              className=\"absolute right-2 bottom-2 p-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 disabled:opacity-50 transition-colors\"\n            >\n              <PaperAirplaneIcon className=\"w-5 h-5\" />\n            </button>\n          </div>\n          <p className=\"text-[10px] text-center text-slate-400 mt-2\">\n            AI可能会犯错，仅供参考，不可替代专业医疗建议。\n          </p>\n        </div>\n      </div>\n\n      {/* Right Panel - Visualization & Diagnosis */}\n      <div className=\"hidden md:flex flex-col w-2/3 bg-slate-50 h-full overflow-hidden\">\n        \n        <header className=\"h-16 px-6 bg-white border-b border-slate-200 flex items-center justify-between shrink-0\">\n          <div className=\"flex items-center space-x-2 text-slate-700\">\n            <ChartBarIcon className=\"w-5 h-5 text-blue-600\" />\n            <span className=\"font-semibold\">临床分析面板</span>\n          </div>\n          <button\n            onClick={handleAnalyze}\n            disabled={isAnalyzing || messages.length < 2}\n            className={`flex items-center space-x-2 px-4 py-2 rounded-lg font-medium text-sm transition-all ${\n              isAnalyzing \n                ? 'bg-slate-100 text-slate-400 cursor-not-allowed'\n                : 'bg-emerald-600 text-white hover:bg-emerald-700 shadow-md hover:shadow-lg'\n            }`}\n          >\n            <ArrowPathIcon className={`w-4 h-4 ${isAnalyzing ? 'animate-spin' : ''}`} />\n            <span>{isAnalyzing ? '分析中...' : '更新分析'}</span>\n          </button>\n        </header>\n\n        {/* Content Grid */}\n        <div className=\"flex-1 p-6 overflow-hidden\">\n          <div className=\"grid grid-cols-1 lg:grid-cols-2 gap-6 h-full\">\n            \n            {/* Left Column of Dashboard: Differential Diagnosis List */}\n            <div className=\"flex flex-col h-full bg-white rounded-2xl shadow-sm border border-slate-200 overflow-hidden\">\n              <div className=\"p-4 border-b border-slate-100 bg-slate-50 flex items-center justify-between\">\n                <h2 className=\"font-semibold text-slate-800\">鉴别诊断</h2>\n                <span className=\"text-xs text-slate-500 bg-white px-2 py-1 rounded border\">最匹配</span>\n              </div>\n              <div className=\"flex-1 overflow-hidden p-2\">\n                 <DiagnosisPanel data={analysisResult} isLoading={isAnalyzing} />\n              </div>\n            </div>\n\n            {/* Right Column of Dashboard: Sankey Chart */}\n            <div className=\"flex flex-col h-full bg-white rounded-2xl shadow-sm border border-slate-200 overflow-hidden\">\n               <div className=\"p-4 border-b border-slate-100 bg-slate-50 flex items-center justify-between\">\n                <h2 className=\"font-semibold text-slate-800\">症状图谱</h2>\n                <div className=\"flex items-center space-x-4 text-xs\">\n                    <div className=\"flex items-center space-x-1\">\n                        <span className=\"w-2 h-2 rounded-full bg-blue-400\"></span>\n                        <span className=\"text-slate-500\">症状</span>\n                    </div>\n                    <div className=\"flex items-center space-x-1\">\n                        <span className=\"w-2 h-2 rounded-full bg-red-400\"></span>\n                        <span className=\"text-slate-500\">疾病</span>\n                    </div>\n                </div>\n              </div>\n              <div className=\"flex-1 p-4\">\n                 <SankeyChart data={analysisResult} />\n              </div>\n            </div>\n\n          </div>\n        </div>\n\n        {/* Footer Warning */}\n        <div className=\"p-3 bg-amber-50 border-t border-amber-100 flex items-center justify-center space-x-2 text-amber-700 text-xs shrink-0\">\n          <ExclamationTriangleIcon className=\"w-4 h-4\" />\n          <span>本工具仅用于演示，紧急情况请立即拨打急救电话。</span>\n        </div>\n      </div>\n\n    </div>\n  );\n};\n\nexport default App;\n"],"names":[],"mappings":"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"}}]
}